# Data and code for Miller-ter Kuile et al. 2021

This repository includes the data and code to reproduce the analyses in a manuscript by Miller-ter Kuile et al. examining the roles of predator body size and hunting strategy on prey size selection based on DNA metabarcoding data. 

## [code metadata](#code)

## [data metadata](#data)

# Explanation of folders and contents

## art

A folder of watercolor artwork produced for this project by Miller-ter Kuile. 

## code

The code scripts for reproducing the bioinformatics, data tidying, and data analysis steps in this paper. 

### 1_denoising

A subfolder including three sub-folders of the steps taken to perform the bioinformatics steps for this project

#### 1a_trim_sequences

*'cutadapt_primer_trimming.txt'*: a text file of command line script to cut primer adapters from all DNA sequencing data

#### 1b_dada2

*'1b1_dada2_separate_cross_run_error.R'*: R script for performing the error generating step in the dada2 algorithm to compare cross-sequencing run error rates. These error rates should be similar in order to combine multiple sequencing runs to perform the full dada2 denoising algorithm

*'1b2_cross_run_error.R'*: R script for producing the figures comparing cross-sequencing run errors

*'1b3_dada2_combined_runs.R'*: R script for performing the dada2 algorithm to produce the final denoised ASV list and ASV-by-sample tables used in subsequent analyses.

#### 1c_unoise

*'unoise_code.txt'*: command line script used to perform the unoise3 algorithm on the sequencing data. The input had already been run through the primer-cutting step.

#### 1d_blast_code

*'knot.blast.bash.script.txt'*: bash script submitted to UCSB computing cluster for assigning DNA sequences to taxonomic identifiers based on the nucleotide GenBank database.

### 2_qc

*2a_prelim_sequencing_depth_check.R*: R script for rarefaction curve for our initial MiSeq NANO run with 4 samples to determine how many samples to run per sequencing run to achieve sufficient sequencing depth. 

*2b_seq_depth_dadavsunoise.R*: R script comparing sequencing depth per sample for the dada2 and unoise3 algorithms

*2c_cross-run_sample_comparisons.R*: R script of analyses of the 19 samples re-run on all four sequencing runs to report run-to-run variability in sequencing depth and resulting prey ASV assignments.

*2d_multiple_individuals.R*: R script of analyses comparing samples that consisted of only one versus multiple individuals to verify that samples with multiple individuals were not over-represented in interaction data.

*2e_control_samples.R*: R script examining ASV assignment to positive and negative controls as an estimate of ASV assignment specificity and sequencing error due to sequence jumping. 

### 3_data_prep

*3a_low_sampling_depth_cutoff.R*: R script used to determine the quantile cutoff for removing samples with insufficient sequencing depth to be compared to the rest of the samples.

*3b_master_taxonomy_list.R*: R script combining GenBank and BOLD taxonomic assignments and merging these into a master list. 

*3c_rarefy_samples.R*: R script used to rarefy the samples for subsequent analyses.

*3d_subset_diet_taxonomies.R*: R script for removing all ASVs either not assigned a taxonomic identification or which did not match to prey taxonomies (e.g. predator DNA, environmental DNA such as fungi, etc.).

*3e_master_body_size_list.R*: R script combining all sources of body size data for predators and prey

*3f_predator_mass_length_models.R*: R script used to create mixed effects models of predator mass-length to give mass values to predators for which these data were not collected.

*3g_interactions_w_body_size.R*: R script that combines the predator-prey interactions to the body size dataset and produces the final dataset used in statstical analyses. 

### 4_analyses

*4a_pred_prey_size.R*: R script used to run the predator prey mass linear mixed effects models and model selection process. Includes code for creating figures. 

*4b_feeding_mode_ratios.R*: R Script of the feeding mode predator-prey size ratio statistical models and model selection process. Includes code for creating figures.

### 5_supp_figures

*data_summary_tables.R*: R script to produce summary tables of sample sizes by predator species

*prey_phylogeny.R*: R script to produce the supplementary prey phylogeny figure.

## data

The folder which contains data input in scripts and generated by scripts. The raw DNA sequencing data (prior to DADA2) is too large for GitHub and can be found on GenBank.

### outputs

This folder contains all the files created in data preparation steps in R scripts. The R script which generates the data correspond to the names of each data output folder. 

#### 3a_depth_corrected

*cross_run_samples.csv*: The sample by ASV matrix for the 19 samples re-run across all four sequencing runs 

*depth_subset_samples.csv*: The sample by ASV matrix of the remaining after those that were sequenced too low were removed in the __ script.  

#### 3b_taxonomic_assignment

##### a_export_for_manual_entry

*ASV_taxonomies.csv*: The taxonomic assignments combined for both BOLD and GenBank for all ASVs in the dataset

##### b_import_after_manual_entry

*ASV_taxonomies_wIndiv.csv*: The above taxonomic assignments with additional taxonomic assignments that come from individual BLAST.

##### c_final_dataset

*ASV_taxonomies_w_Indiv.csv*: All taxonomic assignments with cleaned columns removing the GenBank and BOLD assignment columns.

#### 3c_rarefied

*community_rare.csv*: All samples rarefied to the read abundance of the sample with the lowest sequencing depth 

*cross_run_rare.csv*: The 19 samples which were re-run across all four sequencing runs rarefied to the read abundance of the sample with the lowest sequencing depth. 

#### 3d_rarefied_taxonomic_sort

*all_prey_DNA.csv*: Any ASVs which received taxonomic assignments at any taxonomic level that could be assigned to prey items (e.g. not predators from an individual run and not environmental DNA such as fungi, etc).

*fam_prey_DNA_conservative.csv*: All prey ASVs assigned to the family level. This is 'conservative' because I removed predator ASVs from ANY predator on a given sequencing run to ensure that detection of predator DNA in a predator sample was not due to sequence jumping.

*predator_DNA.csv*: The resulting DNA corresponding to predators in each sample. 

#### 3e_master_body_size_lists

*pred_mass_length.csv*: The combined mass and length data for all measured individuals of predator species/families in this study from Palmyra and the literature.

*prey_mass_length.csv*: The combined mass and length data for all measured individuals corresponding to potential prey in this study drawn from Palmyra and the literature. 

#### 3f_pred_mass_length

*DNA_pred_mass_length.csv*: The measured length data for predator individuals from our study combined with the predicted mass data taken from the mass-length mixed model. 

#### 3g_final_dataset

*pred_prey_sizes_DNAinteractions.csv*: The dataset used in the statistical analyses, which includes the predator mass and length, prey mass and length, and all prey families detected per predator sample in the dataset. 

  - **sample**: the predator sample in which the DNA sequence was found
  
  - **hunting_mode**: the hunting mode of the predator species
  
  - **venom**: whether the predator species uses venom
  
  - **webs**: whether the predator species uses webs
  
  - **pred_length_mm**: the length of the predator
  
  - **pred_log_length_mm**: the log10 transformed length of the predator
  
  - **pred_log_mass_mg**: the predicted mass of the predator from the mass-length model
  
  - **sample_str**: the three-letter code corresponding to the predator species
  
  - **Class**: the class taxonomic assignment of the prey DNA (combined ASVs)
  
  - **Order**: the order taxonomic assignment of the prey DNA (combined ASVs)
  
  - **Family**: the family taxonomic assignment of the prey DNA (combined ASVs)
  
  - **reads**: the cumulative read abundance of that prey Class-Order-Family of all ASVs in that sample
  
  - **mean_prey_length_mm**: the mean length of the prey family based on the master body size list
  
  - **mean_prey_mass_mg**: the mean mass of the prey family based on the master body size list
  
  - **min_prey_length_mm**: the minimum length of the prey family based on the master body size list
  
  - **min_prey_mass_mg**: the mininum mass of the prey family based on the master body size list
  
  - **mean_prey_log_mass_mg**: the log10 transformed mean prey family mass
  
  - **min_prey_log_mass_mg**: the log10 transformed minimum prey family mass
  
### raw_data

This folder contains two raw data files along with subdirectories for other raw data used in various steps.

*Predator_IDs.csv*: data on the species and traits of each predator in the study.

*Sample_metadata.csv*: data for each predator sample collected for this study, including collection date and location, number of individuals per sample, and the length of each individual. Additional fields correspond to whether 

#### 1_denoised_data

##### dada2

###### a_crossrun_error_checking

*forward_errors.csv*: forward error rates generated on each sequencing run used to justify combining samples into one dada2 step

*reverse_errors.csv*: reverse error rates generated on each sequencing run used to justify combining samples into one dada2 step

###### b_combined_runs

*ASVs_all.fasta*: the list of unique ASVs assigned via dada2

*ASVs_counts_all.tsv*: the ASV by sample matrix generated from dada2

*DADA2_sum_stats.csv*: the by-sample statistics of reads filtered, merged, chimeric, and the final percent of reads retained for each sample. 

##### unoise

*denoised.fasta*: the list of unique ASVs assigned via unoise3

*zotu_table_a-l.txt*: the sample by ASV matrices for the samples run through unoise3. These are separate files due to the file size limiations of the free, 32-bit version of unoise3

#### 2_qc

*prelim_seq_depth_check.csv*: sequencing data for four samples run on an initial MiSeq NANO run to determine how many samples could be run per normal MiSeq run to generate ample sequencing depth. These samples were filtered, merged, and clustered using the UCLUST algorithm from USEARCH around 97% similar OTUs.

#### 3_taxonomies

Taxonomic assignment results obtained from BOLD and GenBank databases

##### BOLD_combined

*bold_wID.csv*: the bold.csv dataset with all levels of taxonomic identification from Phylum -> species filled in.

*bold.csv*: The combined taxonomic assignments for all BOLD searches

##### BOLD_raw

*BOLD_0-17.csv*: The results of the BOLD searches against the ASV list generated by DADA2. These are in separate files because of ASV number limitations in the BOLD online database search tool. 

##### NCBI

*DADA_MAY-ex.txt*: the text output from MEGAN including the taxonomic assignments of each ASV from the GenBank database obtained using BLAST.

*DADA_MAY.rma6*: a file which can be opened in MEGAN to view and explore the taxonomic assignments from the GenBank database

*ncbi.csv*: a .csv version of the DADA_MAY-ex.txt file.

#### 4_body_size_data

*DNA_pred_lengths_ana.csv*: the length data for the predators in the sample dataset

*Pal_UG_mass_length.csv*: mass-length data collected from Palmyra Atoll as part of the unpublished undergradate thesis of [Miller-ter Kuile](https://www.researchgate.net/publication/304346482_Resource_availability_determines_abundance_predator_body_size_and_food_web_structure_in_terrestrial_arthropod_communities_at_Palmyra_Atoll)

*Palmyra_BS_Feb2021.csv*: mass-length data collected from Palmyra Atoll by many of the co-authors (McLaughlin et al.)

*Palmyra_nodenames.csv*: the species list from Palmyra Atoll generated by co-authors (McLaughlin et al.). 

*Sohlstroem_mass_length.csv*: mass-length data from a study published by Sohlstrom et al. ([2018](https://datadryad.org/stash/dataset/doi:10.5061/dryad.vk24fr1)) including many of the families from Palmyra Atoll from other tropical environments.

*su_pantala_mass_length.csv*: mass-length data from a study published by Su et al. ([2020](https://jeb.biologists.org/content/223/14/jeb218552.long)) on the mass-length relationship for one predator species in this study, the odonate *Pantala flavescens*. 

## drafts

Drafts of manuscript, supplementary materials, and notes from meetings with collaborators on this project

## figures

The exported figures from R, the Affinity Designer files used to post-process figures, and the final figures used in both the main text and the supplement.





